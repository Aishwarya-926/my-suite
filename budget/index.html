<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet Watch | Budget Tracker</title>
    
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js for the Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #2563eb;
            --bg: #f3f4f6;
            --text: #1f2937;
            --success: #10b981; /* Green for Income */
            --danger: #ef4444;  /* Red for Expense */
            --card: #ffffff;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 800px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        /* Responsive: Side by side on desktop */
        @media (min-width: 768px) {
            .container { grid-template-columns: 1fr 1fr; }
            .full-width { grid-column: span 2; }
        }

        /* --- Cards --- */
        .card {
            background: var(--card);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        /* --- Header / Balance --- */
        .balance-card {
            text-align: center;
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
        }

        .balance-title { font-size: 0.9rem; opacity: 0.9; }
        .balance-amount { font-size: 2.5rem; font-weight: 700; margin: 10px 0; }
        
        .inc-exp-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 12px;
        }
        
        .money { font-weight: 600; }
        .money.plus { color: #86efac; }
        .money.minus { color: #fca5a5; }

        /* --- Form --- */
        h3 { margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        
        .form-control { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-size: 0.9rem; color: #666; }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            box-sizing: border-box;
            outline: none;
        }
        input:focus { border-color: var(--primary); }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: 0.2s;
        }
        .btn:hover { opacity: 0.9; }

        /* --- List --- */
        .history-list {
            list-style: none;
            padding: 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .transaction {
            background: #fff;
            border-bottom: 1px solid #eee;
            color: var(--text);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            position: relative;
        }

        .transaction-info { display: flex; flex-direction: column; }
        .t-cat { font-size: 0.8rem; color: #888; margin-top: 2px; }
        
        .transaction-amount { font-weight: 600; }
        .plus { color: var(--success); }
        .minus { color: var(--danger); }

        .delete-btn {
            background: #fee2e2;
            color: var(--danger);
            border: none;
            border-radius: 4px;
            padding: 2px 8px;
            cursor: pointer;
            font-size: 1.2rem;
            margin-left: 10px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .transaction:hover .delete-btn { opacity: 1; }

        /* --- Chart Container --- */
        .chart-container {
            position: relative;
            height: 250px;
            display: flex;
            justify-content: center;
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- 1. Header & Balance -->
        <div class="card balance-card full-width">
            <div class="balance-title">Current Balance</div>
            <div class="balance-amount" id="balance">‚Çπ0.00</div>
            <div class="inc-exp-container">
                <div>
                    <span style="font-size: 0.8rem">INCOME</span><br>
                    <span id="money-plus" class="money plus">+‚Çπ0.00</span>
                </div>
                <div style="border-left: 1px solid rgba(255,255,255,0.3); padding-left: 20px;">
                    <span style="font-size: 0.8rem">EXPENSE</span><br>
                    <span id="money-minus" class="money minus">-‚Çπ0.00</span>
                </div>
            </div>
        </div>

        <!-- 2. Add Transaction Form -->
        <div class="card">
            <h3>Add New Transaction</h3>
            <form id="form">
                <div class="form-control">
                    <label>Description</label>
                    <input type="text" id="text" placeholder="e.g. Salary, Grocery..." required>
                </div>
                
                <div class="form-control">
                    <label>Amount (Negative = Expense, Positive = Income)</label>
                    <input type="number" id="amount" placeholder="-500 or 20000" required step="1">
                </div>

                <div class="form-control">
                    <label>Category</label>
                    <select id="category">
                        <option value="Food">üçî Food</option>
                        <option value="Transport">üöó Transport</option>
                        <option value="Shopping">üõçÔ∏è Shopping</option>
                        <option value="Bills">üßæ Bills/Rent</option>
                        <option value="Income">üí∞ Income</option>
                        <option value="Other">‚ú® Other</option>
                    </select>
                </div>

                <button class="btn">Add Transaction</button>
            </form>
        </div>

        <!-- 3. Visual Analytics -->
        <div class="card">
            <h3>Spending Breakdown</h3>
            <div class="chart-container">
                <canvas id="expenseChart"></canvas>
            </div>
            <p style="text-align: center; font-size: 0.8rem; color: #888; margin-top: 10px;">Based on your expenses</p>
        </div>

        <!-- 4. History List -->
        <div class="card full-width">
            <h3>History</h3>
            <ul id="list" class="history-list">
                <!-- Items added here by JS -->
            </ul>
        </div>
    </div>

<script>
    // --- DOM Elements ---
    const balanceEl = document.getElementById('balance');
    const moneyPlusEl = document.getElementById('money-plus');
    const moneyMinusEl = document.getElementById('money-minus');
    const listEl = document.getElementById('list');
    const form = document.getElementById('form');
    const textInput = document.getElementById('text');
    const amountInput = document.getElementById('amount');
    const categoryInput = document.getElementById('category');
    
    // --- State ---
    let transactions = JSON.parse(localStorage.getItem('myWallet')) || [];
    let myChart = null; // Chart instance

    // --- Functions ---

    function formatMoney(number) {
        // Changed to 'en-IN' for Indian Rupee Formatting (e.g. 1,50,000)
        return number.toLocaleString('en-IN', { 
            style: 'currency', 
            currency: 'INR',
            maximumFractionDigits: 2
        });
    }

    function addTransaction(e) {
        e.preventDefault();

        if(textInput.value.trim() === '' || amountInput.value.trim() === '') {
            alert('Please add a text and amount');
            return;
        }

        const transaction = {
            id: Date.now(),
            text: textInput.value,
            amount: +amountInput.value, // Convert string to number
            category: categoryInput.value
        };

        transactions.push(transaction);
        updateLocalStorage();
        init();

        textInput.value = '';
        amountInput.value = '';
    }

    function deleteTransaction(id) {
        if(confirm('Delete this record?')) {
            transactions = transactions.filter(t => t.id !== id);
            updateLocalStorage();
            init();
        }
    }

    function updateLocalStorage() {
        localStorage.setItem('myWallet', JSON.stringify(transactions));
    }

    function updateValues() {
        const amounts = transactions.map(t => t.amount);

        const total = amounts.reduce((acc, item) => (acc += item), 0);
        
        const income = amounts
            .filter(item => item > 0)
            .reduce((acc, item) => (acc += item), 0);

        const expense = (amounts
            .filter(item => item < 0)
            .reduce((acc, item) => (acc += item), 0) * -1);

        balanceEl.innerText = formatMoney(total);
        moneyPlusEl.innerText = `+${formatMoney(income)}`;
        moneyMinusEl.innerText = `-${formatMoney(expense)}`;
    }

    function renderList() {
        listEl.innerHTML = '';
        
        // Show most recent first
        const reversedList = [...transactions].reverse();

        reversedList.forEach(transaction => {
            const sign = transaction.amount < 0 ? '-' : '+';
            const itemClass = transaction.amount < 0 ? 'minus' : 'plus';
            const amountAbs = Math.abs(transaction.amount);

            const li = document.createElement('li');
            li.classList.add('transaction');
            li.innerHTML = `
                <div class="transaction-info">
                    <span>${transaction.text}</span>
                    <span class="t-cat">${transaction.category}</span>
                </div>
                <div style="display:flex; align-items:center;">
                    <span class="transaction-amount ${itemClass}">${sign}${formatMoney(amountAbs)}</span>
                    <button class="delete-btn" onclick="deleteTransaction(${transaction.id})">x</button>
                </div>
            `;
            listEl.appendChild(li);
        });
    }

    function renderChart() {
        const ctx = document.getElementById('expenseChart').getContext('2d');
        
        // 1. Filter only expenses (negative numbers)
        const expenses = transactions.filter(t => t.amount < 0);
        
        // 2. Group by Category
        const categories = {};
        expenses.forEach(t => {
            if(categories[t.category]) {
                categories[t.category] += Math.abs(t.amount);
            } else {
                categories[t.category] = Math.abs(t.amount);
            }
        });

        // 3. Prepare Data for Chart
        const labels = Object.keys(categories);
        const data = Object.values(categories);

        // Define colors for categories
        const colors = ['#ef4444', '#f59e0b', '#3b82f6', '#8b5cf6', '#10b981', '#6b7280'];

        // 4. Destroy old chart if exists (to prevent overlap on update)
        if(myChart) {
            myChart.destroy();
        }

        // 5. Draw Chart
        if(expenses.length === 0) {
             return; 
        }

        myChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: colors,
                    borderWidth: 0,
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: { boxWidth: 10, font: { family: 'Outfit' } }
                    }
                }
            }
        });
    }

    // --- Init ---
    function init() {
        renderList();
        updateValues();
        renderChart();
    }

    form.addEventListener('submit', addTransaction);
    init();

</script>
</body>
</html>
